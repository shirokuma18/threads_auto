# Threads運用 学習ログ

> 仮説検証と改善の記録。最新30日分を保持。

---

## 2025-10-31（システム設計刷新: posted_history.csv 完全廃止）

### 💡 重大な気づき

**posted_history.csv も threads.db も不要だった**

### 問題だった複雑な設計
```
posts_schedule.csv → threads.db → posted_history.csv
      ↓                ↓              ↓
投稿後に削除       状態管理       重複防止
```

**問題点:**
- 3つのデータソースの同期が必要
- CSVから削除すると履歴が失われる
- タイムゾーン問題で同期が壊れる
- 複雑すぎてバグが入る

### シンプルな新設計

```
posts_schedule.csv (すべての投稿、削除しない)
    +
.last_posted_at (前回実行時刻)
    ↓
scheduled_at が (last_posted_at, now] の範囲 → 投稿
```

**仕組み:**
1. `.last_posted_at` から前回実行時刻を読む
2. CSV から `scheduled_at が (last_posted_at, now]` の範囲を抽出
3. その範囲の投稿を順番に投稿（60秒間隔）
4. 投稿完了後、現在時刻を `.last_posted_at` に保存

**メリット:**
- ✅ posted_history.csv 不要
- ✅ threads.db 不要
- ✅ CSVから削除不要（すべての投稿が永久保存される）
- ✅ 冪等性（何度実行しても同じ時間範囲だけ）
- ✅ 単一の信頼できる情報源（CSV）
- ✅ タイムゾーン問題もシンプル
- ✅ 同期問題ゼロ

### 📝 学び

**複雑さはバグの温床**
- 3つのファイル管理 → 1つのCSV + 1つのタイムスタンプ
- 削除・同期ロジック → 時間範囲抽出だけ
- 状態管理DB → 不要（CSVが全て）

**単一の信頼できる情報源 (Single Source of Truth)**
- posts_schedule.csv がすべて
- 他は一時的な実行状態だけ

---

## 2025-10-31（重大バグ修正: タイムゾーン問題で重複投稿）

### 🐛 重大バグの発見
- 投稿ID 29と23が**同じ投稿が2回投稿される**バグで両方ともスパム認定
- 根本原因: 投稿後のクリーンアップが実行されていなかった

### 💡 原因分析
**タイムゾーンの不一致**

GitHub Actionsは UTC で動作:
1. 投稿時刻 08:39 JST = 2025-10-30 23:39 UTC
2. Python `datetime.now()` が UTC時刻を保存: "2025-10-30 23:39:00"
3. ワークフローのクエリ: `DATE(posted_at) = date('now', '+9 hours')` = "2025-10-31"
4. `DATE('2025-10-30 23:39:00')` = "2025-10-30" ≠ "2025-10-31"
5. マッチせず → クリーンアップされない → 再投稿 → スパム認定

### ✅ 修正内容
すべての `datetime.now()` を JST (UTC+9) に統一:

```python
# 修正前
posted_at = datetime.now()  # UTC時刻

# 修正後
jst = timezone(timedelta(hours=9))
posted_at = datetime.now(jst).replace(tzinfo=None)  # JST時刻
```

**修正箇所:**
- `mark_as_posted()`: 投稿時刻の記録
- `save_analytics()`: 分析データ取得時刻
- `get_recent_posts()`: 過去N日間の判定
- `generate_pdca_markdown()`: レポート表示時刻

### 📝 学び
- GitHub Actionsは UTC で動作することを前提にする
- タイムゾーン変換は早めにやる（保存時に変換）
- クエリの日付比較は同じタイムゾーンで統一必須

---

## 2025-10-31（スパム認定）

### 📊 検証データ
- 投稿ID: 29（コンビニ節約の投稿）
- 結果: スパム認定され削除

### 💡 スパム判定された要因
1. **数字の羅列**
   - 2万円、24万円、19,500円、4,000円、31,000円...
   - 金額が多すぎて情報商材に見える

2. **結果誘導型の構成**
   - 「○○したら△△できた」形式
   - Before/After比較が広告的

3. **箇条書きの多用**
   - リスト形式が多いとノウハウ販売っぽい

4. **人間味の不足**
   - 結果ばかり強調
   - 感情・迷い・失敗が少ない
   - 「成功体験の報告」に見える

### ❌ 問題の本質
**「体験談化」したつもりが、まだ広告的だった**
- 体験談 ≠ 成功報告
- 必要なのは「今まさに悩んでいる」感じ
- 結果よりプロセス、数字より感情

### 🎯 改善アクション
1. **数字を減らす**
   - 具体的な金額は1-2個まで
   - 「月2万円使ってた」程度に留める

2. **完成形を避ける**
   - 「やめて3日目」「続けられるかな」
   - 未完成・進行中の状態を書く

3. **感情を増やす**
   - 「めっちゃ行きたい」「我慢してる」
   - 迷いや葛藤を正直に

4. **箇条書きを減らす**
   - 自然な会話調で
   - リスト形式は最小限に

### 📝 書き換え例

**NG（スパム認定）:**
```
2ヶ月経った今：
コンビニ代: 4,000円/月
節約額: 31,000円（2ヶ月で）
```

**OK（人間的）:**
```
コンビニ行かないチャレンジ、3日目。
めっちゃ行きたい。
でも頑張る。
```

---

## 2025-10-31（投稿改訂）

### 📊 検証データ
- 改訂前: 51投稿（教科書的45、リアルタイム6）
- 改訂後: 63投稿（リアルタイム18、体験談25、ノウハウ20）

### 💡 仮説
**バランスが何事も大切**
- リアルタイム試行錯誤だけでは持続困難
- 教科書的ノウハウも価値はある
- 3つのタイプをバランス良く配置

**新規作成（12投稿）:**
貯金チャレンジ、朝活、マッチングアプリ挑戦、副業、断る練習、NISA、残業削減、お弁当、SNS発信継続、早寝早起き、コンビニ断ち、感謝の習慣

**体験談化（11投稿）:**
恋愛依存、貯金不安、クレカ整理、休職、断り方、結婚焦り、会議発言、朝活、コンビニ節約、友達以上恋人未満、元カレ

### ✅ 結果
投稿構成をバランス型に再構築。「中に人がいる感じ」を保ちながら、役立つノウハウも提供する形に。

### 🎯 改善アクション
- リアルタイム投稿は継続的に追加
- パフォーマンスデータで3タイプの効果を検証
- 比率は柔軟に調整

---

## 2025-10-31

### 📊 検証データ
- 最高パフォーマンス: 表示832回、いいね41

### 💡 仮説（修正版）
成功の本質は「メタ投稿」ではなく「リアルな成長過程」
- 中に人がいる感じ
- 試行錯誤している様子
- 学びを得て頑張っている姿

### ✅ 結果
本質的な気づきを得た。形式（短文/長文）ではなく、コンテンツの人間味が重要。

### 🎯 改善アクション
AI的教科書コンテンツから脱却し、リアルな体験・学びの記録に注力する

---

## 2025-10-31

### 📊 検証データ
- 総投稿数: 35件（前日）
- 平均表示: 42.03回
- 平均いいね: 1.67
- パフォーマンス分布: 高37% / 中27% / 低40%

### 💡 仮説（事前）
**AI予約投稿の想定:**
- 「悩み＋解決策」対話形式
- 【ステップ】構造化
- カテゴリ: 恋愛、お金、仕事、メンタル、占い

### ❌ 失敗要因
**問題は文字数ではなくトピック選択**

1. **概念的すぎる**
   - ✗ HSP、燃え尽き症候群、自己肯定感 → 専門用語
   - ✓ NISA、元カレ、貯金 → 具体的

2. **実用性が低い**
   - ✗ 占い（数秘術、月星座） → 娯楽的
   - ✓ NISA、貯金 → すぐ実行可能

3. **重すぎる/抽象的**
   - ✗ 社会批判（使い捨て、報われない） → ネガティブ
   - ✓ ミニマル暮らし → ポジティブ

### ✅ 成功パターンの本質
**高パフォーマンス TOP 3:**
1. 試行錯誤の記録（84文字、表示832）→ リアルな成長過程
2. ミニマル暮らし（127文字、表示53）→ 個人の実践記録
3. 仮説検証報告（56文字、表示34）→ 学びのプロセス

**長文でも成功:**
- NISA（479文字、表示30）→ 具体的な体験談があれば
- 元カレ（456文字、表示28）→ 個人の物語があれば

**→ 本質: "中に人がいる感じ" "リアルな成長過程" が見えるコンテンツ**
- ✓ 試行錯誤している様子
- ✓ 学びを得て頑張っている姿
- ✓ 失敗も含めた成長の記録
- ✗ 誰が書いたかわからない教科書的な内容

### 🎯 改善アクション
1. **削除実行:** 低パフォーマンス17件（メタ5 + 占い/社会批判/概念的12）
2. **トピック最適化:** 63件 → 51件に絞り込み
3. **削除トピック:** タロット占い、数秘術、月星座、HSP、自己肯定感、完璧主義、ポジティブ思考、メンタルヘルス、報連相、燃え尽き症候群、脈あり脈なし、給料交渉
4. **残すトピック:** お金（9種）、恋愛（12種）、仕事（10種）、生活（6種）

### 📈 次の方針
**コンテンツの本質:**
- ✓ リアルな成長過程を記録する（試行錯誤、失敗、学び）
- ✓ 「中に人がいる」感じを出す
- ✓ 自分の体験・実践・気づきを書く
- ✗ AI的な教科書的コンテンツは作らない

**トピック選択:**
- 具体的・実用的・ポジティブ
- 自分が実際に経験したor学んだこと
- 避ける: 概念的・専門用語・抽象的批判・誰が書いても同じ内容

---

## テンプレート（次回以降）

```markdown
## YYYY-MM-DD

### 📊 検証データ
- 投稿数: X件
- 平均表示: X回
- トップ投稿: [トピック] (表示X, いいねX)

### 💡 仮説
[今日試したこと]

### ✅/❌ 結果
[うまくいった/いかなかった理由]

### 🎯 改善アクション
[次にやること]
```

---

## 更新方法

```bash
# 手動更新
nano /Users/ibuki/threads_auto/learnings.md

# または自動追記スクリプト
python3 /Users/ibuki/threads_auto/threads_sqlite.py update-learnings --text "今日の気づき"
```
