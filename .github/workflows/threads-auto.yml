name: Threads Auto Posting

on:
  # 投稿スケジュール（定期実行）
  schedule:
    # 毎日 8, 10, 12, 15, 17, 19, 20, 21, 22, 23, 24時 JST (12枠 × 5投稿 = 60投稿/日)
    - cron: '0 23 * * *'  # 8:00 JST (23:00 UTC 前日)
    - cron: '0 1 * * *'   # 10:00 JST (1:00 UTC)
    - cron: '0 3 * * *'   # 12:00 JST (3:00 UTC)
    - cron: '0 6 * * *'   # 15:00 JST (6:00 UTC)
    - cron: '0 8 * * *'   # 17:00 JST (8:00 UTC)
    - cron: '0 10 * * *'  # 19:00 JST (10:00 UTC)
    - cron: '0 11 * * *'  # 20:00 JST (11:00 UTC)
    - cron: '0 12 * * *'  # 21:00 JST (12:00 UTC)
    - cron: '0 13 * * *'  # 22:00 JST (13:00 UTC)
    - cron: '0 14 * * *'  # 23:00 JST (14:00 UTC)
    - cron: '0 15 * * *'  # 24:00 JST (15:00 UTC)

  # 手動実行
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest

    steps:
      - name: リポジトリをチェックアウト (main ブランチ)
        uses: actions/checkout@v3
        with:
          ref: main
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Python環境をセットアップ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 依存関係をインストール
        run: pip install requests python-dotenv

      - name: シンプル投稿スクリプトを実行
        run: python3 threads_simple.py
        env:
          THREADS_ACCESS_TOKEN: ${{ secrets.THREADS_ACCESS_TOKEN }}
          THREADS_USER_ID: ${{ secrets.THREADS_USER_ID }}

  # 毎朝のレポート投稿（毎日9時 JST）
  daily-report:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 0 * * *'  # 9:00 JST (0:00 UTC)

    steps:
      - name: リポジトリをチェックアウト (main ブランチ)
        uses: actions/checkout@v3
        with:
          ref: main
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Python環境をセットアップ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 依存関係をインストール
        run: pip install requests python-dotenv

      - name: Daily Reportを生成・投稿
        run: python3 threads_simple.py daily-report
        env:
          THREADS_ACCESS_TOKEN: ${{ secrets.THREADS_ACCESS_TOKEN }}
          THREADS_USER_ID: ${{ secrets.THREADS_USER_ID }}
