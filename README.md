# Threads Auto Posting（教室短編アカウント運用）

Threadsへの定期投稿と、1日完結の短編連載を自動化するためのリポジトリです。単一CSVから投稿し、夜厚めの配置やA/B実験（文字数・スレッド・投稿数）までを最小コードで運用します。

## 1) これだけやれば動く（Quick Start）
- `.env` を用意（下の「環境変数」参照）
- スケジュールCSVを用意（`data/posts_schedule.csv` 推奨。未設定時はルートの `posts_schedule.csv` を自動検出）
- 実行
  - ローカル: `python3 threads_simple.py`（試すだけなら `--dry-run`）
  - Actions: リポジトリのGitHub Actionsを有効化（30分刻みで自動投稿）

## 2) 仕組み（完全ステートレス）
- 単一の情報源: `posts_schedule.csv`
- 現在時刻→30分ターム（JST 8:00〜23:30, 計32枠）のうち±10分一致を採用
- 最近の投稿をAPIで取得して先頭100文字で重複判定→未投稿のみ投稿
- 1実行につき最大1投稿（スパム対策）

メリット: 冪等・状態ファイル不要・API照合で重複防止・cron遅延に強い

## 3) スケジュールと実験
- 標準: 30分刻み（JST 8:00〜23:30）/ 1回1投稿
- 夜厚め: `retime_night_heavy.py` で平日を夜寄せ（17:00〜23:30中心）
- 投稿数A/B: `generate_compact_day.py` で ppd=12（12投稿/日）を生成（対照はppd=25）
- 1週間一括生成: `generate_week_experiment.py`（夜枠は一部スレッド返信を付与）
- 解析: `python3 analyze_experiments.py 2025-11-09 2025-11-15`
  - 出力: like率/返信率 + ppd + 時間帯（morning/afternoon/evening/night）

実験タグ（`hashtags`列, 例）
```
exp:len=M;op=sensory;end=yoin;br=3;concept=observation;tense=present;emoji=0;thread=yes
exp:ppd=12
```

## 4) CSV（場所とフォーマット）
- 解決順: `CSV_FILE`（env）→ `data/posts_schedule.csv` → `./posts_schedule.csv`
- 形式（UTF-8 / 改行OK）
```
id,datetime,text,thread_text,status,category,subcategory,hashtags
2025111001,2025-11-10 08:00,"本文…",,pending,教室短編,ランドセルの重さ,"exp:len=M;…"
```
- `thread_text`があれば本編への返信として1つだけ続けます（露骨な誘導はしない方針）

## 5) コンテンツ指針（要点）
- バランス: ①リアルタイム挑戦 ②体験談 ③役立ち（概ね 3:5:2）
- スパム回避: 数字は1–2個/箇条書きは最大3/Before-After禁止/感情を入れる/完成形を避ける
- 文体: 一人称・現在時制・五感の具体物を置く・露骨なCTAや「続きは」禁止
- 時間帯: 平日日中は弱い → 夜（20–23時）を厚めに

## 6) 実行コマンド（よく使うもの）
- 投稿: `python3 threads_simple.py`（ドライランは `--dry-run`）
- 夜寄せ: `python3 retime_night_heavy.py 2025-11-11 2025-11-13 2025-11-15`
- 12投稿日: `python3 generate_compact_day.py 2025-11-12:放課後の光線 2025-11-14:休符の居場所`
- 週次生成: `python3 generate_week_experiment.py`
- 解析: `python3 analyze_experiments.py 2025-11-09 2025-11-15`
- 即時投稿（固定文）: `python3 post_now.py`

## 7) 固定投稿とプロフィール（採用中の文）
固定投稿（ピン留めはアプリで手動）
```
本が好きで国語の先生になりました。
いまは実体験と想像をまぜて、教室に残った匂いや小さな声を短編にしています。
目標は「芥川賞の候補に入ること」。
毎晩、一篇を23:30までに静かに結びます。過程も失敗も、そのままここに。
```
プロフィール（例）
- 表示名: スレッズ短編小説｜元国語教師
- Bio: 本が好きで国語の先生に。実体験と想像を重ねた短編を、朝から夜へ少しずつ。毎晩23:30までに一篇を結びます。目標は「芥川賞の候補に入ること」。

## 8) 環境変数とセットアップ
`.env` 例:
```
THREADS_ACCESS_TOKEN=your_token_here
THREADS_USER_ID=your_user_id_here
CSV_FILE=data/posts_schedule.csv
```
- トークン取得: `python3 setup_long_lived_token.py`
- 依存関係: `pip install -r requirements.txt`（`requests`, `python-dotenv`）

## 9) リポジトリ構成（最小）
```
threads_auto/
├── threads_simple.py
├── data/ (任意)
│   └── posts_schedule.csv
├── *.py （generate_*, analyze_*, retime_*, post_now など）
└── README.md（本ドキュメントに運用と指針を集約）
```

---
運用開始: 2025-10-29 / ステートレス刷新: 2025-10-31

## 10) 小説コンセプトと原理原則（運用の土台）

- コンセプト
  - 元・小学校教師の一人称で、教室と子どもをめぐる「小さな出来事」を物語にする
  - 目で見える印（点・線・棚・位置）と、言葉にならない感覚（匂い・温度・間）で心の動きを描く
  - 読み手が「何が起き、誰が何を感じたか」を自然に追える、違和感のないリズムで進む

- 視点と語り
  - 視点は一人称「私」（教師）に固定
  - 叙述（情景・内面）は常体／生徒や保護者との会話は丁寧語
  - 心理は断定しない。「〜かもしれない」「〜ように見える」で余白を残す

- コア原則（テーマ）
  - 選べる合図：鳴らす／鳴らさない、残す／消す、置く／持つ——選択が安心を生む
  - 見える工夫→言葉の順：まず目に見える目印を置き、説明は後から最短距離で
  - 自己決定の面積を増やす：正解を与えるのではなく、判断を本人に残す
  - 待つ力：焦りで介入しない。安全が確保されたうえで「待つ」を設計する
  - 始まりを守る：最初の点・最初の一歩を踏ませない配慮（はじまりの尊重）

- 題材の扱い（生徒・家庭・人間関係・葛藤）
  - 生徒の気持ち：行動・まなざし・手の強さ／弱さ・間の取り方で示し、推測は根拠を添える
  - 家庭環境：必要最小限の事実のみ。固有名詞は避ける／合成・匿名化
  - 人間関係：先生—子ども—家庭—同僚の張力を評価でなく配置で見せる
  - 葛藤：教師としての迷い・待つ不安・介入の線引きを短い内語で置く

- トーン／文体
  - 情景→台詞→心の声が自然に入れ替わるリズム（説明過多にしない）
  - 比喩は近景（教室の物・音・光）に限定し、飛躍しない
  - 最後の一文は薄い余韻（方向だけ示す）。「続きは」等の露骨な誘導はしない

- モチーフ（反復して使う要素）
  - 物：黒板・チョーク・名札ケース・ランドセル・窓の光・時計
  - 音：鈴・足音・自転車のチェーン・蛍光灯の唸り
  - 印：点・線・待ち合わせ・半分だけ残す・朝の黒

- 倫理と配慮
  - 個人が特定される情報は使用しない／匿名化する
  - 診断的・ラベリング表現は避ける
  - 安全が揺らぐ題材は十分に抽象化し、回復の線を先に設計する

- 1日の流れとメタ層
  - 本編：朝→昼→放課後→夜で空気の変化と共に「印（点・線・棚）」が更新される
  - 22:00：その日の意図と気持ちを、先生の声で独立投稿として短く振り返る（解説者口調は禁止）

- 断片の最低条件（分割時のチェック）
  - 1段落目で「場所・誰・何をした」を明示（主語と動作をはっきり）
  - 会話は「誰の発話」か一読で分かるように配置
  - 1断片＝1出来事＋1感情（増やしすぎない）
  - 単体でも意味が取れること（連結前提の省略をしすぎない）

- 分割の原則（投稿化のため）
  - 先行断片の最後に「次の印（行為）」の準備を置く（例：点→線、線→待ち合わせ）
  - 連続する2断片では、片方を情景濃いめ、もう片方を会話濃いめにしてテンポを作る
  - 21:30で本編を閉じ、22:00に先生の振り返りを独立投稿として置く

- やらないこと
  - 教条化（教訓を言い切る）／過度の詩化（意味が取りづらい比喩）／過度な外在化（家庭の断定）
  - 「解説者の高い視点」にならず、常に教師の身の丈の視界から語る
